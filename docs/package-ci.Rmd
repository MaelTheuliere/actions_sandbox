---
title: "package-ci"
author: "Murray Cadzow"
date: "12/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(eval = FALSE)
```
# Example workflow CI for packages

This is an example workflow to create a package and use Github actions apply continuous integration to automatically check and test packages upon a git push.

Github actions are included in the dev version of `usethis` which can be installed from github using

```{r}
# install.packages("devtools")
devtools::install_github("r-lib/usethis")
```


## Package setup



create a package
```{r}
usethis::create_package()
```

initialise git repository
```{r}
usethis::use_git()
```

- create a blank repository on github

add the github remote
```{r}
usethis::use_github("username/repo")
```

create a readme
```{r}
usethis::use_readme_md()
```

create a licence
```{r}
# use of MIT licence
use_mit_license()
```



Fill in the description with the github urls
```{r}
usethis::use_github_links()
use_github_action()
```

This creates the required files for using the github action that runs devtools::check() on github and includes a badge in your readme

Now git add, commit the changes and push them to your repo and the action will run.

## Automatically document package

Need command to add for the github action

## Automatically create pkgdown documentation

Derived from: https://pkgdown.r-lib.org/reference/deploy_site_github.html

First we need to create an empty gh-pages branch. In bash:

```
git checkout --orphan gh-pages
git rm -rf .
git commit --allow-empty -m 'Initial gh-pages commit'
git push origin gh-pages
git checkout master
```

Now we can add in pkgdown
```{r}
use_pkgdown()
```

Then we want to add in the github action for pkgdown to automatically add documentation
```{r}
usethis:::use_github_action(url = "https://raw.githubusercontent.com/r-lib/actions/master/examples/pkgdown.yaml")
```

