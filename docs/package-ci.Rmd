---
title: "package-ci"
author: "Murray Cadzow"
date: "12/12/2019"
output: 
 html_document:
   toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(eval = FALSE)
```
# Example workflow CI for packages

This is an example workflow to create a package and use Github actions apply continuous integration to automatically check and test packages upon a git push.

Github actions are included in the dev version of `usethis` which can be installed from github using

```{r}
# install.packages("devtools")
devtools::install_github("r-lib/usethis")
```


## Package setup and connect with Github

### New project, Github first

Follow instructions https://happygitwithr.com/new-github-first.html#new-github-first

Create a package
```{r}
usethis::create_package(path = "path-to-project")
```

### Existing package with github

Make sure that you have github setup with your package.

[Existing project and package, github first](https://happygitwithr.com/existing-github-first.html#existing-github-first)
[Existing project and package, github last](https://happygitwithr.com/existing-github-last.html#existing-github-last)

## Add github action for package release-check


```{r}
usethis::use_github_actions()
```

This creates the required files for using the github action that runs the release-check for a package on github and includes the code to add the badge in your readme.

Now git add, commit the changes and push them to your repo and the action will run.


## Automatically create pkgdown documentation

Derived from: https://pkgdown.r-lib.org/reference/deploy_site_github.html

First we need to create an empty gh-pages branch. In bash:

```
git checkout --orphan gh-pages
git rm -rf .
git commit --allow-empty -m 'Initial gh-pages commit'
git push origin gh-pages
git checkout master
```

Now we can add in pkgdown
```{r}
use_pkgdown()
```

Then we want to add in the github action for pkgdown to automatically add documentation
```{r}
usethis:::use_github_action(url = "https://raw.githubusercontent.com/r-lib/actions/master/examples/pkgdown.yaml")
```

